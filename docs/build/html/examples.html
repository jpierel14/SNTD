

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simulating with SNTD &mdash; SNTD 1.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="Installation" href="install.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> SNTD
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulating with SNTD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#no-microlensing">No Microlensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulating-microlensing">Simulating Microlensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#including-microlensing-in-simulations">Including Microlensing in Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#measuring-time-delays-with-sntd">Measuring Time Delays with SNTD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fitting-a-multiply-imaged-supernova">Fitting a Multiply-Imaged Supernova</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-using-extra-propagation-effects">Fitting Using Extra Propagation Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimating-uncertainty-due-to-microlensing">Estimating Uncertainty Due to Microlensing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#using-your-own-data-with-sntd">Using Your Own Data with SNTD</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SNTD</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Simulating with SNTD</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="simulating-with-sntd">
<h1>Simulating with SNTD<a class="headerlink" href="#simulating-with-sntd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="no-microlensing">
<h2>No Microlensing<a class="headerlink" href="#no-microlensing" title="Permalink to this headline">¶</a></h2>
<p>Create a simulated multiply-imaged supernova that we can then fit,
with no microlensing included in the simulation. Note that your final
printed information will be different, as this is a randomly generated
supernova.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sntd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">myMISN</span> <span class="o">=</span> <span class="n">sntd</span><span class="o">.</span><span class="n">createMultiplyImagedSN</span><span class="p">(</span><span class="n">sourcename</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span> <span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mf">1.33</span><span class="p">,</span><span class="n">z_lens</span><span class="o">=.</span><span class="mi">53</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F125W&#39;</span><span class="p">],</span>
              <span class="n">zp</span><span class="o">=</span><span class="p">[</span><span class="mf">26.8</span><span class="p">,</span><span class="mf">26.2</span><span class="p">],</span> <span class="n">cadence</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mf">35.</span><span class="p">,</span><span class="n">time_delays</span><span class="o">=</span><span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">70.</span><span class="p">],</span> <span class="n">magnifications</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span>
              <span class="n">objectName</span><span class="o">=</span><span class="s1">&#39;My Type Ia SN&#39;</span><span class="p">,</span><span class="n">telescopename</span><span class="o">=</span><span class="s1">&#39;HST&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myMISN</span><span class="p">)</span>
<span class="n">myMISN</span><span class="o">.</span><span class="n">plot_object</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Telescope</span><span class="p">:</span> <span class="n">HST</span>
<span class="n">Object</span><span class="p">:</span> <span class="n">My</span> <span class="n">Type</span> <span class="n">Ia</span> <span class="n">SN</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">bands</span><span class="p">:</span> <span class="mi">2</span>

<span class="o">------------------</span>
<span class="n">Image</span><span class="p">:</span> <span class="n">image_1</span><span class="p">:</span>
<span class="n">Bands</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;F125W&#39;</span><span class="p">,</span> <span class="s1">&#39;F110W&#39;</span><span class="p">]</span>
<span class="n">Date</span> <span class="n">Range</span><span class="p">:</span> <span class="mf">0.00000</span><span class="o">-&gt;</span><span class="mf">56.61765</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">points</span><span class="p">:</span> <span class="mi">24</span>

<span class="n">Metadata</span><span class="p">:</span>
 <span class="n">z</span><span class="p">:</span><span class="mf">1.33</span>
 <span class="n">t0</span><span class="p">:</span><span class="mf">10.0</span>
 <span class="n">x0</span><span class="p">:</span><span class="mf">6.705277050626183e-06</span>
 <span class="n">x1</span><span class="p">:</span><span class="mf">1.4432846464012696</span>
 <span class="n">c</span><span class="p">:</span><span class="mf">0.06617632319259452</span>
 <span class="n">sourcez</span><span class="p">:</span><span class="mf">1.33</span>
 <span class="n">hostebv</span><span class="p">:</span><span class="mf">0.0967741935483871</span>
 <span class="n">lensebv</span><span class="p">:</span><span class="mi">0</span>
 <span class="n">lensz</span><span class="p">:</span><span class="mf">0.53</span>
 <span class="n">mu</span><span class="p">:</span><span class="mi">7</span>
 <span class="n">td</span><span class="p">:</span><span class="mf">10.0</span>
<span class="o">------------------</span>
<span class="n">Image</span><span class="p">:</span> <span class="n">image_2</span><span class="p">:</span>
<span class="n">Bands</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;F125W&#39;</span><span class="p">,</span> <span class="s1">&#39;F110W&#39;</span><span class="p">]</span>
<span class="n">Date</span> <span class="n">Range</span><span class="p">:</span> <span class="mf">41.17647</span><span class="o">-&gt;</span><span class="mf">118.38235</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">points</span><span class="p">:</span> <span class="mi">32</span>

<span class="n">Metadata</span><span class="p">:</span>
 <span class="n">z</span><span class="p">:</span><span class="mf">1.33</span>
 <span class="n">t0</span><span class="p">:</span><span class="mf">70.0</span>
 <span class="n">x0</span><span class="p">:</span><span class="mf">3.3526385253130915e-06</span>
 <span class="n">x1</span><span class="p">:</span><span class="mf">1.4432846464012696</span>
 <span class="n">c</span><span class="p">:</span><span class="mf">0.06617632319259452</span>
 <span class="n">sourcez</span><span class="p">:</span><span class="mf">1.33</span>
 <span class="n">hostebv</span><span class="p">:</span><span class="mf">0.0967741935483871</span>
 <span class="n">lensebv</span><span class="p">:</span><span class="mi">0</span>
 <span class="n">lensz</span><span class="p">:</span><span class="mf">0.53</span>
 <span class="n">mu</span><span class="p">:</span><span class="mf">3.5</span>
 <span class="n">td</span><span class="p">:</span><span class="mf">70.0</span>
<span class="o">------------------</span>
</pre></div>
</div>
<p>Out:</p>
<a class="reference internal image-reference" href="_images/noML_fig.png"><img alt="alternate text" class="align-center" src="_images/noML_fig.png" style="width: 600px; height: 600px;" /></a>
</div>
<div class="section" id="simulating-microlensing">
<h2>Simulating Microlensing<a class="headerlink" href="#simulating-microlensing" title="Permalink to this headline">¶</a></h2>
<p>Simulate a microlensing microcaustic, and use it to include a microlensing effect in
the simulated supernova.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">myML</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">realizeMicro</span><span class="p">(</span><span class="n">nray</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">kappas</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">kappac</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">gamma</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
<span class="n">time</span><span class="p">,</span><span class="n">dmag</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">microcaustic_field_to_curve</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">myML</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">zl</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span><span class="n">zs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<a class="reference internal image-reference" href="_images/micro_fig.png"><img alt="alternate text" class="align-center" src="_images/micro_fig.png" style="width: 600px; height: 600px;" /></a>
</div>
<div class="section" id="including-microlensing-in-simulations">
<h2>Including Microlensing in Simulations<a class="headerlink" href="#including-microlensing-in-simulations" title="Permalink to this headline">¶</a></h2>
<p>Now we can take the simulated microcaustic and use it to include microlensing in a multiply-imaged supernova simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">myMISN2</span> <span class="o">=</span> <span class="n">sntd</span><span class="o">.</span><span class="n">createMultiplyImagedSN</span><span class="p">(</span><span class="n">sourcename</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span> <span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mf">1.33</span><span class="p">,</span><span class="n">z_lens</span><span class="o">=.</span><span class="mi">53</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F125W&#39;</span><span class="p">],</span>
               <span class="n">zp</span><span class="o">=</span><span class="p">[</span><span class="mf">26.8</span><span class="p">,</span><span class="mf">26.2</span><span class="p">],</span> <span class="n">cadence</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mf">35.</span><span class="p">,</span><span class="n">time_delays</span><span class="o">=</span><span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">70.</span><span class="p">],</span> <span class="n">magnifications</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span>
               <span class="n">objectName</span><span class="o">=</span><span class="s1">&#39;My Type Ia SN&#39;</span><span class="p">,</span><span class="n">telescopename</span><span class="o">=</span><span class="s1">&#39;HST&#39;</span><span class="p">,</span> <span class="n">microlensing_type</span><span class="o">=</span><span class="s1">&#39;AchromaticMicrolensing&#39;</span><span class="p">,</span><span class="n">microlensing_params</span><span class="o">=</span><span class="n">myML</span><span class="p">)</span>
<span class="n">myMISN2</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">showMicro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<a class="reference internal image-reference" href="_images/withML_fig.png"><img alt="alternate text" class="align-center" src="_images/withML_fig.png" style="width: 600px; height: 600px;" /></a>
</div>
</div>
<div class="section" id="measuring-time-delays-with-sntd">
<h1>Measuring Time Delays with SNTD<a class="headerlink" href="#measuring-time-delays-with-sntd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="fitting-a-multiply-imaged-supernova">
<h2>Fitting a Multiply-Imaged Supernova<a class="headerlink" href="#fitting-a-multiply-imaged-supernova" title="Permalink to this headline">¶</a></h2>
<p>There are 3 methods built into SNTD to measure time delays (separate, combined, color). They are accessed by the same function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitCurves</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">myMISN2</span><span class="p">,</span><span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F125W&#39;</span><span class="p">],</span>
         <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span><span class="n">constants</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mf">1.33</span><span class="p">},</span><span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="s1">&#39;x1&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)},</span>
         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;separate&#39;</span><span class="p">,</span><span class="n">microlensing</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">fitCurves</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">showFit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;separate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<a class="reference internal image-reference" href="_images/separateFit_fig.png"><img alt="alternate text" class="align-center" src="_images/separateFit_fig.png" style="width: 600px; height: 600px;" /></a>
<p><strong>Note that the bounds for the ‘t0’ parameter are not absolute, the actual peak time will be estimated (unless t0_guess is defined)
and the defined bounds will be added to this value. Similarly for amplitude, where bounds are multiplicative</strong></p>
</div>
<div class="section" id="fitting-using-extra-propagation-effects">
<h2>Fitting Using Extra Propagation Effects<a class="headerlink" href="#fitting-using-extra-propagation-effects" title="Permalink to this headline">¶</a></h2>
<p>You might also want to include other propagation effects in your fitting model, and fit relevant parameters. This can be done by
simply adding effects to an SNCosmo model, in the same way as if you were fitting a single SN with SNCosmo. First we can add some
extreme dust in the source and lens frames (your final simulations may look slightly different as <strong>c</strong> is chosen randomly):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">myMISN</span> <span class="o">=</span> <span class="n">sntd</span><span class="o">.</span><span class="n">createMultiplyImagedSN</span><span class="p">(</span><span class="n">sourcename</span><span class="o">=</span><span class="s1">&#39;salt2&#39;</span><span class="p">,</span> <span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">redshift</span><span class="o">=</span><span class="mf">1.45</span><span class="p">,</span><span class="n">z_lens</span><span class="o">=.</span><span class="mi">53</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F160W&#39;</span><span class="p">],</span>
      <span class="n">zp</span><span class="o">=</span><span class="p">[</span><span class="mf">26.9</span><span class="p">,</span><span class="mf">26.2</span><span class="p">],</span> <span class="n">cadence</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mf">35.</span><span class="p">,</span><span class="n">time_delays</span><span class="o">=</span><span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">70.</span><span class="p">],</span> <span class="n">magnifications</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
      <span class="n">objectName</span><span class="o">=</span><span class="s1">&#39;My Type Ia SN&#39;</span><span class="p">,</span><span class="n">telescopename</span><span class="o">=</span><span class="s1">&#39;HST&#39;</span><span class="p">,</span><span class="n">av_lens</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
      <span class="n">av_host</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myMISN</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simMeta</span><span class="p">[</span><span class="s1">&#39;lensebv&#39;</span><span class="p">],</span>
     <span class="n">myMISN</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simMeta</span><span class="p">[</span><span class="s1">&#39;hostebv&#39;</span><span class="p">],</span>
     <span class="n">myMISN</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simMeta</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.48387096774193544</span> <span class="mf">0.3225806451612903</span> <span class="mf">0.0980253825067111</span>
</pre></div>
</div>
<p>Okay, now we can fit the MISN first without taking these effects into account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitCurves</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">myMISN</span><span class="p">,</span><span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="s1">&#39;salt2&#39;</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F160W&#39;</span><span class="p">],</span>
                                             <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span>
                                             <span class="n">constants</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">},</span>
                                             <span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="s1">&#39;x1&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)},</span>
                                             <span class="n">showPlots</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span> <span class="mi">1</span><span class="p">:</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/example_plot_no_dust_image_1.png"><img alt="alternate text" class="align-center" src="_images/example_plot_no_dust_image_1.png" style="width: 600px; height: 400px;" /></a>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span> <span class="mi">2</span><span class="p">:</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/example_plot_no_dust_image_2.png"><img alt="alternate text" class="align-center" src="_images/example_plot_no_dust_image_2.png" style="width: 600px; height: 400px;" /></a>
<p>We can see that the fitter has done reasonably well, and the time delay is still accurate (True delay is 60 days).
However, one issue is that the measured value for <strong>c</strong> (0.805) is vastly different than the actual value (0.098)
as it attempts to compensate for extinction without a propagation effect. Now let’s add in the propagation effects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dust</span> <span class="o">=</span> <span class="n">sncosmo</span><span class="o">.</span><span class="n">CCM89Dust</span><span class="p">()</span>
<span class="n">salt2_model</span><span class="o">=</span><span class="n">sncosmo</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;salt2&#39;</span><span class="p">,</span><span class="n">effects</span><span class="o">=</span><span class="p">[</span><span class="n">dust</span><span class="p">,</span><span class="n">dust</span><span class="p">],</span><span class="n">effect_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lens&#39;</span><span class="p">,</span><span class="s1">&#39;host&#39;</span><span class="p">],</span><span class="n">effect_frames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;free&#39;</span><span class="p">,</span><span class="s1">&#39;rest&#39;</span><span class="p">])</span>
<span class="n">fitCurves</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">myMISN</span><span class="p">,</span><span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">salt2_model</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F160W&#39;</span><span class="p">],</span>
                <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;lensebv&#39;</span><span class="p">,</span><span class="s1">&#39;hostebv&#39;</span><span class="p">],</span>
                <span class="n">constants</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span><span class="s1">&#39;lensr_v&#39;</span><span class="p">:</span><span class="mf">3.1</span><span class="p">,</span><span class="s1">&#39;lensz&#39;</span><span class="p">:</span><span class="mf">0.53</span><span class="p">,</span><span class="s1">&#39;hostr_v&#39;</span><span class="p">:</span><span class="mf">3.1</span><span class="p">},</span>
                <span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="s1">&#39;x1&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;lensebv&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span><span class="s1">&#39;hostebv&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">)},</span>
                <span class="n">showPlots</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span> <span class="mi">1</span><span class="p">:</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/example_plot_dust_image_1.png"><img alt="alternate text" class="align-center" src="_images/example_plot_dust_image_1.png" style="width: 600px; height: 400px;" /></a>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span> <span class="mi">2</span><span class="p">:</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/example_plot_dust_image_2.png"><img alt="alternate text" class="align-center" src="_images/example_plot_dust_image_2.png" style="width: 600px; height: 400px;" /></a>
<p>Now the measured value for <strong>c</strong> (0.057) is much closer to reality, and the measured times of peak are somewhat
more accurate.</p>
</div>
<div class="section" id="estimating-uncertainty-due-to-microlensing">
<h2>Estimating Uncertainty Due to Microlensing<a class="headerlink" href="#estimating-uncertainty-due-to-microlensing" title="Permalink to this headline">¶</a></h2>
<p>Now we can estimate the additioinal uncertainty on the time delay measurement caused by microlensing. The final number printed below
is just the measured microlensing uncertainty, there is an additional uncertainty on t0 that can be combined in quadrature.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitCurves</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">myMISN2</span><span class="p">,</span><span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F110W&#39;</span><span class="p">,</span><span class="s1">&#39;F125W&#39;</span><span class="p">],</span>
        <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span><span class="n">constants</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mf">1.33</span><span class="p">},</span><span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="s1">&#39;x1&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)},</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;separate&#39;</span><span class="p">,</span><span class="n">microlensing</span><span class="o">=</span><span class="s1">&#39;achromatic&#39;</span><span class="p">,</span><span class="n">nMicroSamples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fitCurves</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">final_errs</span><span class="p">[</span><span class="s1">&#39;micro&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.7979254133200879</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-your-own-data-with-sntd">
<h1>Using Your Own Data with SNTD<a class="headerlink" href="#using-your-own-data-with-sntd" title="Permalink to this headline">¶</a></h1>
<p>In order to fit your own data, you must turn your light curve into an astropy table. There is an example multiply-imaged
SN example provided for reference. In this example, we have a doubly-imaged SN with image files (in the sntd/data/examples folder)
‘example_image_1.dat’ and ‘example_image_2.dat’. The only optional column in these files is “image”, which sets the name of the key
used to reference this SN image. If you do not provide flux/fluxerr but instead magnitude/magerr SNTD will attemp to translate to
flux/fluxerr, but it’s best to simply provide flux from the beginning to avoid conversion errors. First we can read in these tables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ex_1</span><span class="p">,</span><span class="n">ex_2</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">load_example_data</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">ex_1</span><span class="p">)</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">time</span>         <span class="n">band</span>        <span class="n">flux</span>        <span class="o">...</span>  <span class="n">zp</span>  <span class="n">zpsys</span>  <span class="n">image</span>
<span class="o">------------------</span> <span class="o">-----</span> <span class="o">------------------</span> <span class="o">...</span> <span class="o">----</span> <span class="o">-----</span> <span class="o">-------</span>
               <span class="mf">0.0</span> <span class="n">F125W</span>  <span class="mf">64.59429430606906</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">2.0224719101123596</span> <span class="n">F125W</span>    <span class="mf">62.408324396966</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">4.044943820224719</span> <span class="n">F125W</span>  <span class="mf">68.10359798573809</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">6.067415730337078</span> <span class="n">F125W</span>  <span class="mf">71.76160753594853</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">8.089887640449438</span> <span class="n">F125W</span>  <span class="mf">73.43467553050705</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">10.112359550561798</span> <span class="n">F125W</span>  <span class="mf">74.34296720689296</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">12.134831460674157</span> <span class="n">F125W</span>  <span class="mf">71.73347707161632</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">14.157303370786517</span> <span class="n">F125W</span>  <span class="mf">72.93187923529568</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">16.179775280898877</span> <span class="n">F125W</span>  <span class="mf">70.64111678688164</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">18.202247191011235</span> <span class="n">F125W</span>  <span class="mf">69.31085357488871</span> <span class="o">...</span> <span class="mf">26.8</span>    <span class="n">AB</span> <span class="n">image_1</span>
               <span class="o">...</span>   <span class="o">...</span>                <span class="o">...</span> <span class="o">...</span>  <span class="o">...</span>   <span class="o">...</span>     <span class="o">...</span>
<span class="mf">38.426966292134836</span> <span class="n">F160W</span> <span class="mf">19.950527074094737</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">40.449438202247194</span> <span class="n">F160W</span> <span class="mf">20.963076283234553</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">42.47191011235955</span> <span class="n">F160W</span> <span class="mf">21.402880246191344</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">44.49438202247191</span> <span class="n">F160W</span>  <span class="mf">18.28098879531828</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">46.51685393258427</span> <span class="n">F160W</span> <span class="mf">18.947732390210522</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">48.53932584269663</span> <span class="n">F160W</span> <span class="mf">15.987591900959364</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">50.56179775280899</span> <span class="n">F160W</span> <span class="mf">20.011941798193966</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">52.58426966292135</span> <span class="n">F160W</span> <span class="mf">15.516064719260328</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">54.60674157303371</span> <span class="n">F160W</span>   <span class="mf">17.1543325162061</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
 <span class="mf">56.62921348314607</span> <span class="n">F160W</span>  <span class="mf">18.25136177909449</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="mf">58.651685393258425</span> <span class="n">F160W</span> <span class="mf">17.198071229182016</span> <span class="o">...</span> <span class="mf">26.2</span>    <span class="n">AB</span> <span class="n">image_1</span>
<span class="n">Length</span> <span class="o">=</span> <span class="mi">60</span> <span class="n">rows</span>
</pre></div>
</div>
<p>Now, to turn these two data tables into an SNTD curveDict object that will be fit, we use the table_factory function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_MISN</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">table_factory</span><span class="p">([</span><span class="n">ex_1</span><span class="p">,</span><span class="n">ex_2</span><span class="p">],</span><span class="n">telescopename</span><span class="o">=</span><span class="s1">&#39;HST&#39;</span><span class="p">,</span><span class="n">object_name</span><span class="o">=</span><span class="s1">&#39;example_SN&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">new_MISN</span><span class="p">)</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Telescope</span><span class="p">:</span> <span class="n">HST</span>
<span class="n">Object</span><span class="p">:</span> <span class="n">example_SN</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">bands</span><span class="p">:</span> <span class="mi">2</span>

<span class="o">------------------</span>
<span class="n">Image</span><span class="p">:</span> <span class="n">image_1</span><span class="p">:</span>
<span class="n">Bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;F160W&#39;</span><span class="p">,</span> <span class="s1">&#39;F125W&#39;</span><span class="p">])</span>
<span class="n">Date</span> <span class="n">Range</span><span class="p">:</span> <span class="mf">0.00000</span><span class="o">-&gt;</span><span class="mf">58.65169</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">points</span><span class="p">:</span> <span class="mi">60</span>
<span class="o">------------------</span>
<span class="n">Image</span><span class="p">:</span> <span class="n">image_2</span><span class="p">:</span>
<span class="n">Bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;F160W&#39;</span><span class="p">,</span> <span class="s1">&#39;F125W&#39;</span><span class="p">])</span>
<span class="n">Date</span> <span class="n">Range</span><span class="p">:</span> <span class="mf">40.44944</span><span class="o">-&gt;</span><span class="mf">119.32584</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">points</span><span class="p">:</span> <span class="mi">80</span>
<span class="o">------------------</span>
</pre></div>
</div>
<p>And finally let’s fit this SN, which is a Type Ia, with the SALT2 model (your exact time delay may
be slightly different after fitting the example data). For reference, the true delay here is 60 days.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitCurves</span><span class="o">=</span><span class="n">sntd</span><span class="o">.</span><span class="n">fit_data</span><span class="p">(</span><span class="n">new_MISN</span><span class="p">,</span><span class="n">snType</span><span class="o">=</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="s1">&#39;salt2&#39;</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F125W&#39;</span><span class="p">,</span><span class="s1">&#39;F160W&#39;</span><span class="p">],</span>
                <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span><span class="n">constants</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mf">1.33</span><span class="p">},</span>
                <span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;t0&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="s1">&#39;x1&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)})</span>
<span class="k">print</span><span class="p">(</span><span class="n">fitCurves</span><span class="o">.</span><span class="n">time_delays</span><span class="p">)</span>
<span class="n">fitCurves</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">showFit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;image_1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;image_2&#39;</span><span class="p">:</span> <span class="mf">60.2649320870058</span><span class="p">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/example_fit.png"><img alt="alternate text" class="align-center" src="_images/example_fit.png" style="width: 600px; height: 600px;" /></a>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Justin Pierel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>